# Metacinema: backend

Бэкенд часть проекта Metacinema команды `git push --force`

## Стек
### Язык и библиотеки
- Golang
  - Fiber (web) - популярный веб фреймворк для Golang
  - sqlc - утилита для генерации быстрого и безопасного кода для работы с БД
### Инфраструктура
- PostgreSQL - популярная СУБД, в проекте используется для хранения информации о пользователях, фильмах, диванах
- MinIO (S3) - S3-совместимое хранилище, используется в проекте для хранения фотокарточек фильмов
- Grafana (Prometheus) - популярный сервис визуализации статистики


## Архитектура бэкенда

Архитектура проекта представлена собой тремя слоями:

- Презентационный (API)
- Сервисный (UserService, CinemaService, etc.)
- Инфраструктурный (PostgreSQL, MinIO)

При проектировании бэкенда мы обращались к правилам чистой архитектуры и старались их придерживаться.
![](../media/ProjectStructure.png)


## Тест-кейсы

Ниже написано примерное описание эндпоинтов проекта и их путь (префикс /api/v1). Также информацию об эндпоинтах вы можете найти в исходном коде в папке `internal/api/handlers/v1`

Также на сервере развернут swagger по адресу `/api/v1/docs`

### Пользователь
- Регистрация пользователя (POST /users/sign-up)
- Логин (POST /users/sign-in)
- Поиск пользователя (POST /users/search)

### Фильмы
- Создание приватных фильмов (POST /films)
- Создание публичных фильмов (POST /admin/films, для админов)
- Получение фильма по ID (GET /films/{filmId})
- Получение высоко оцениваемых фильмов (GET /films/popular)
- Получение рекомендованных фильмов (GET /films/feed)
- Изменение фотокарточки фильма (POST /films/{filmdId}/picture)
- Поиск фильмов (GET /films/search)

### Лайки/дизлайки
- Получить список "посмотреть позже"/посмотреть лайки (GET /plans)
- Добавить фильм в список "посмотреть позже"/лайк (POST /films/{filmId}/like)
- Убрать фильм из списка "посмотреть позже"/удалить лайк (DELETE /films/{filmId}/like)
- Добавить фильм в blacklist/дизлайк  (POST /films/{filmId}/dislike)
- Убрать фильм из blacklist/удалить дизлайк  (DELETE /films/{filmId}/dislike)
- Поставить оценку фильму (POST /films/{filmId}/rate)

### Диваны
- Создание дивана (POST /couches)
- Обновление дивана (PUT /couches/{couchId})
- Получить список диванов в которых состоит пользователь (GET /couches)
- Получить диван по ID (GET /couches/{couchId})
- Получить список "посмотреть позже" для дивана/посмотреть лайки для дивана (GET /couches/{couchId}/plans)
- Добавить фильм в список "посмотреть позже" для дивана/посмотреть лайки для дивана (POST /couches/{couchId}/films/{filmId}/like)
- Убрать фильм из списка "посмотреть позже" для дивана/убрать лайки для дивана (DELTE /couches/{couchId}/films/{filmId}/like)
- Добавить фильм в blacklist для дивана/дизлайк для дивана (POST /couches/{couchId}/films/{filmId}/dislike)
- Убрать фильм из blacklist для дивана/убрать дизлайк для дивана (DELETE /couches/{couchId}/films/{filmId}/dislike)
- Получение рекомендованных фильмов (GET /couches/{couchId}/feed)

### Покрытие
![](../media/test-coverage.png)
## Структура БД

![](../media/db_scheme.png)






